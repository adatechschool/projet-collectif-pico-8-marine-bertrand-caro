pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--pico8 projet ada
-- panther's adventure

function _init()
--make player
	create_player()
end

function _update()
  player_movement()
end

function _draw()
cls()
map(0,0,0,0,128,64)
spr(p.sprite,p.x,p.y)
update_camera()
end

function create_player()
	p = {
		x=8, y=8, --position init
		dx=0, dy=0, --vitesse init
		sprite = 10,
		speed = 1,
		chest = 0,
		w = 5, h = 6 --largeur et hauteur
	}
end

function player_movement()

	if(btn(⬅️)) p.dx -= p.speed
	if(btn(➡️)) p.dx += p.speed
	if(btn(⬆️)) p.dy -= p.speed
	if(btn(⬇️)) p.dy += p.speed
	
if can_move(p.x+p.dx, p.y, p.w, p.h)
	then p.x += p.dx
end

if can_move(p.x, p.y+p.dy, p.w, p.h)
	then p.y += p.dy
end

p.dx, p.dy = 0,0

if (check_chest(p.x, p.y))
	then get_chest(p.x, p.y)
end

end

function can_move(x, y, w, h)
	if (check_obstacle(x, y)) return false         -- coin haut-gauche
	if (check_obstacle(x+w-1, y)) return false     -- coin haut-droite
	if (check_obstacle(x, y+h-1)) return false     -- coin bas-gauche
	if (check_obstacle(x+w-1, y+h-1)) return false -- coin bas-droite
	return true
end

function check_obstacle(x,y)
	local map_x = flr(x/8)
	local map_y = flr(y/8)
	local sprite = mget(map_x, map_y)
	return fget(sprite, 0)
end
-->8
-- get chest

function get_chest(x,y)
	local sprite_x=flr(x/8)
	local sprite_y=flr(y/8)
	local sprite=mget(sprite_x, sprite_y)
	mset(sprite_x, sprite_y, sprite+1)
	p.chest+=1
	sfx(0)
end

function check_chest(x,y)
	local chest_x = flr(x/8)
	local chest_y = flr(y/8)
	local sprite = mget(chest_x, chest_y)
 return fget(sprite, 1)
end
-->8
-- camera

function update_camera()
	local camx=flr(p.x/128)
	local camy=flr(p.y/128)
	camera(camx*128,camy*96)
end
__gfx__
0000000033333333000004040400000033333333aaaaaaaaf999999f666666666666666600000000000000005555555555555555aa3aa3aaaaaaaaaa00000000
0000000033366333000004040400000033333333aaaaaaaaffffff9f6dddddddddddddd6011111100e0000005999999556666dd5aaa33aaaaaaaaaaa00000000
0070070033666d3300004404044000003b333333aa9aa9aaf9999f9f6d555555555555d6017781100eeeee00594554955666ddd5aa8888aaaaaaaaaa00000000
0007700036655dd3000005555500000033b33b33aaa99aaaf9ff9f9f6d558555555555d60178811000e88e005999999556655dd5a888888aaaa99aaa00000000
0007700036655dd3000004040400000033b3b333aaa99aaaf9ff9f9f6d555555555555d60188781000e55e00595aa59556655dd5a877888aaa9aa9aa00000000
00700700336ddd33000004040400000033bb3333aa9aa9aaf9f99f9f6d555555555555d60111781000eeee00595555955666ddd5a877888aaaaaaaaa00000000
00000000333dd33300000404040000003b3333b3aaaaaaaaf9ffff9f6d555555555555d60111111000e00e0059999995566dddd5488888844444444400000000
0000000033333333000044040440000033333333aaaaaaaaf999999f6d555555555555d600000000000000005555555555555555448888444444444400000000
000000000000000000000555550000000000000000000000000000006d555555555555d6000000000000000033b33b3333333333000000000000000000000000
000000000000000000004404044000000000000000000000000000006d555555555555d60000000000000000333bb33333333333000000000000000000000000
000000000000000000000404040000000000000000000000000000006d555555555555d600000000000000003399993333333333000000000000000000000000
000000000000000000000404040000000000000000000000000000006d555555558555d6000000000000000039999993333bb333000000000000000000000000
000000000000000000000555550000000000000000000000000000006d555555555555d600000000000000003977999333b33b33000000000000000000000000
000000000000000000004404044000000000000000000000000000006d555555555555d600000000000000003977999333333333000000000000000000000000
000000000000000000000404040000000000000000000000000000006dddddddddddddd600000000000000004999999444444444000000000000000000000000
00000000000000000000040404000000000000000000000000000000666666666666666600000000000000004499994444444444000000000000000000000000
__gff__
0001000000000100000100020002000000000000000000000000000200020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010106060606060606060606060606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01040404040401041b0404010404040106050505050605050505050505050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040404040104040404010404040106050d05050505050505050605050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040404040104010104010404040106050505060606060505050605050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040404040104010104010404040106050505060505060606050606050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040404040104040404010404040106050505060505050505050605050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040101010104040404040404040106060606060505050505050605050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040404040104040104040404040405050505050505060606060606050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040101040104040104010404040106060606060505060505050506050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040401040101010104010404040106050505050505060505060506050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040401040404040404010404040106050505050505060505060505050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040401040404040404010404040106050505050505060505060505050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010106060606060606060505060606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009090909090909090505090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009070807080708090708070807080900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009171817181718091718171817180900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009070807080708070708070807080900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009171817181718071718171817180900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009070807080708090708070807080900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009171817181718091718171817180900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009070807080708090708070807080900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000091718170b1718091718171817180900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009181818181818091818181818180900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000009090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00050000397403f7503f7603d7703b7001c7001e7002d700357003e70023500186001f600256002e600376003f6000d50002500100000e0000a00007000050000300001000000000000000000010000100000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000006000010000c0000b00006000090000e00012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
